{
	order dynamic_proxy first
}

:80 {
	encode zstd gzip
	dynamic_proxy

	@management_api expression {vars.upstream}.startsWith('{$MANAGEMENT_API}')
	@static_site expression !{vars.upstream}.startsWith('{$MANAGEMENT_API}')

	# redirect to the management api with a returnTo parameter
	redir @management_api "{vars.upstream}?returnTo={vars.returnTo}"

	reverse_proxy @static_site {vars.upstream} {
		header_up Host {vars.upstream}
	}
}
