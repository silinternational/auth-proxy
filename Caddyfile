{
	order dynamic_proxy first
}

:80 {
	encode zstd gzip

	dynamic_proxy

	@redirect expression {vars.upstream} == {$AUTH_MANAGEMENT_API}
	@reverseproxy expression {vars.upstream} != {$AUTH_MANAGEMENT_API}

	redir @redirect "{$AUTH_MANAGEMENT_API}?returnTo={uri}"
	reverse_proxy @reverseproxy {vars.upstream}
}
